// í”½ì…€í™”
def get_label(image_path, label_path) :
  with open(label_path) as f :
    label = json.load(f)

  xc = float(label['annotations']['bbox_info'][0]['bbox_xcrdnt'])
  yc = float(label['annotations']['bbox_info'][0]['bbox_ycrdnt'])
  w = float(label['annotations']['bbox_info'][0]['bbox_width'])
  h = float(label['annotations']['bbox_info'][0]['bbox_height'])

  image = cv2.imread(image_path, cv2.IMREAD_COLOR)
  # yolo ëª¨ë¸ì— ë§ì¶°ì„œ xì¤‘ì‹¬,yì¤‘ì‹¬,ë„ˆë¹„,ë†’ì´ ê³„ì‚° -> 0~1ì‚¬ì´ ê°’ìœ¼ë¡œ ì •ê·œí™”
  xc_rs = (xc + w/2)/image.shape[0]
  yc_rs = (yc + h/2)/image.shape[1]
  w_rs = (w)/image.shape[0]
  h_rs = (h)/image.shape[1]

  # ì •ë‹µì¶”ì¶œ
  cls_num_origin = label['annotations']['object_class_sclas_code']
  if cls_num_origin == '999' :
    cls_num = 0
  elif cls_num_origin == '007' :
    cls_num = 1
  elif cls_num_origin == '015' :
    cls_num = 2

  return cls_num, xc_rs, yc_rs, w_rs, h_rs

// ì¦ì‹
import os
import cv2
import albumentations as A

# ì¦ì‹ëœ ë°ì´í„° ì €ì¥ ê²½ë¡œ (ì´ë¯¸ ë§Œë“¤ì–´ë‘” í´ë”ë¥¼ ì‚¬ìš©)
aug_image_dir = r""
aug_label_dir = r""

os.makedirs(aug_image_dir, exist_ok=True)
os.makedirs(aug_label_dir, exist_ok=True)

# ì¦ì‹ í•¨ìˆ˜
def augment_image(image_path, label_path, save_image_dir, save_label_dir, num_aug=):
    image = cv2.imread(image_path)
    if image is None:
        print(f"âŒ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: {image_path}")
        return

    # ì´ë¯¸ì§€ í¬ê¸°
    height, width = image.shape[:2]

    # Albumentations ì¦ì‹ ì„¤ì •
    transform = A.Compose([
        A.HorizontalFlip(p=0.5),  # ì¢Œìš° ë°˜ì „
        A.Rotate(limit=15, p=0.5),  # íšŒì „
        A.RandomBrightnessContrast(p=0.2),  # ë°ê¸° ì¡°ì ˆ
        A.GaussianBlur(p=0.2),  # ë¸”ëŸ¬ íš¨ê³¼
    ], bbox_params=A.BboxParams(format="yolo", label_fields=["class_labels"]))

    # ë¼ë²¨(txt) ë¡œë“œ
    with open(label_path, "r") as f:
        lines = f.readlines()

    bboxes = []
    class_labels = []
    for line in lines:
        parts = line.strip().split()
        class_id = int(parts[0])
        x_center, y_center, box_width, box_height = map(float, parts[1:])
        bboxes.append([x_center, y_center, box_width, box_height])
        class_labels.append(class_id)

    # ì¦ì‹ ìˆ˜í–‰
    for i in range(num_aug):  # ë°° ì¦ì‹
        augmented = transform(image=image, bboxes=bboxes, class_labels=class_labels)
        aug_image = augmented["image"]
        aug_bboxes = augmented["bboxes"]

        # ì¦ì‹ëœ ì´ë¯¸ì§€ íŒŒì¼ ì €ì¥
        aug_image_name = f"{os.path.splitext(os.path.basename(image_path))[0]}_aug{i}.jpg"
        aug_image_path = os.path.join(save_image_dir, aug_image_name)
        cv2.imwrite(aug_image_path, aug_image)

        # ì¦ì‹ëœ ë¼ë²¨ íŒŒì¼ ì €ì¥
        aug_label_name = f"{os.path.splitext(os.path.basename(label_path))[0]}_aug{i}.txt"
        aug_label_path = os.path.join(save_label_dir, aug_label_name)
        with open(aug_label_path, "w") as f:
            for bbox, class_id in zip(aug_bboxes, class_labels):
                f.write(f"{class_id} {bbox[0]} {bbox[1]} {bbox[2]} {bbox[3]}\n")

        print(f"âœ… ì¦ì‹ ì™„ë£Œ: {aug_image_path}, {aug_label_path}")


def process_folder(image_dir, label_dir):
    image_files = [f for f in os.listdir(image_dir) if f.lower().endswith((".jpg", ".jpeg", ".png", ".JPG"))]

    if not image_files:
        print(f"âŒ ì´ë¯¸ì§€ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤: {image_dir}")
        return

    for idx, image_file in enumerate(image_files, start=1):
        # ì´ë¯¸ ì¦ì‹ëœ íŒŒì¼(_aug í¬í•¨)ì€ ìŠ¤í‚µ
        if "_aug" in image_file:
            print(f"â© ì¦ì‹ëœ íŒŒì¼ ì œì™¸: {image_file}")
            continue

        image_path = os.path.join(image_dir, image_file)
        label_path = os.path.join(label_dir, os.path.splitext(image_file)[0] + ".txt")

        if not os.path.exists(label_path):
            print(f"âŒ ë¼ë²¨ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤: {label_path}")
            continue

        print(f"ğŸŸ¢ {idx}/{len(image_files)} ì¦ì‹ ì‹œì‘: {image_file}")
        augment_image(image_path, label_path, aug_image_dir, aug_label_dir, num_aug=)


# ì‚¬ìš©ì ì§€ì • ê²½ë¡œ
image_dir = ""  # ì´ë¯¸ì§€ ê²½ë¡œ
label_dir = ""  # ë¼ë²¨ ê²½ë¡œ

# ì¦ì‹ ì‹¤í–‰
process_folder(image_dir, label_dir)

print("ğŸ”§ ëª¨ë“  ì¦ì‹ ì‘ì—… ì™„ë£Œ!")
